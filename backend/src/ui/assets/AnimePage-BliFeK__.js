import{b as H,U as te,i as re,a as ue,c as de,C as Ae,u as pe,r as T,d as ge,e as C,f as Me,g as Ke,h as qe,j as ce,k as G,l as X,o as h,m as B,n as g,w as ve,v as be,p as e,q as ye,s as $,t as Q,x as q,_ as Y,y as he,z as M,A as D,B as ae,D as He,E as Je,F as We,G as we,H as Qe,I as W,J as Xe,K as Ye,L as Ze,M as ke,N as Se,O as Oe,P as z,Q as p,R as je,S as Ee,T as K,V as ea,W as aa,X as ta,Y as m,Z,$ as O,a0 as A,a1 as la,a2 as sa,a3 as na,a4 as oa,a5 as ia,a6 as ra,a7 as ua,a8 as da,a9 as ca,aa as fa,ab as ma,ac as _a,ad as pa,ae as j,af as ee,ag as fe,ah as me,ai as ga,aj as va,ak as ba,al as ya}from"./index-CoSl9Kk1.js";import{E as ha,a as _e,b as wa,c as ka,d as Sa}from"./el-popover-BwdySlht.js";import{E as L}from"./el-tag-ZOztpsLs.js";const $e=H({modelValue:{type:[String,Number,Boolean],default:void 0},size:pe,disabled:Boolean,label:{type:[String,Number,Boolean],default:void 0},value:{type:[String,Number,Boolean],default:void 0},name:{type:String,default:void 0}}),Ea=H({...$e,border:Boolean}),Ve={[te]:c=>re(c)||ue(c)||de(c),[Ae]:c=>re(c)||ue(c)||de(c)},Ce=Symbol("radioGroupKey"),Be=(c,k)=>{const t=T(),i=ge(Ce,void 0),l=C(()=>!!i),w=C(()=>ce(c.value)?c.label:c.value),u=C({get(){return l.value?i.modelValue:c.modelValue},set(s){l.value?i.changeEvent(s):k&&k(te,s),t.value.checked=c.modelValue===w.value}}),y=Me(C(()=>i==null?void 0:i.size)),f=Ke(C(()=>i==null?void 0:i.disabled)),v=T(!1),S=C(()=>f.value||l.value&&u.value!==w.value?-1:0);return qe({from:"label act as value",replacement:"value",version:"3.0.0",scope:"el-radio",ref:"https://element-plus.org/en-US/component/radio.html"},C(()=>l.value&&ce(c.value))),{radioRef:t,isGroup:l,radioGroup:i,focus:v,size:y,disabled:f,tabIndex:S,modelValue:u,actualValue:w}},$a=["value","name","disabled"],Va=G({name:"ElRadio"}),Ca=G({...Va,props:Ea,emits:Ve,setup(c,{emit:k}){const t=c,i=X("radio"),{radioRef:l,radioGroup:w,focus:u,size:y,disabled:f,modelValue:v,actualValue:S}=Be(t,k);function s(){he(()=>k("change",v.value))}return(_,r)=>{var V;return h(),B("label",{class:$([e(i).b(),e(i).is("disabled",e(f)),e(i).is("focus",e(u)),e(i).is("bordered",_.border),e(i).is("checked",e(v)===e(S)),e(i).m(e(y))])},[g("span",{class:$([e(i).e("input"),e(i).is("disabled",e(f)),e(i).is("checked",e(v)===e(S))])},[ve(g("input",{ref_key:"radioRef",ref:l,"onUpdate:modelValue":r[0]||(r[0]=F=>ye(v)?v.value=F:null),class:$(e(i).e("original")),value:e(S),name:_.name||((V=e(w))==null?void 0:V.name),disabled:e(f),type:"radio",onFocus:r[1]||(r[1]=F=>u.value=!0),onBlur:r[2]||(r[2]=F=>u.value=!1),onChange:s,onClick:r[3]||(r[3]=Q(()=>{},["stop"]))},null,42,$a),[[be,e(v)]]),g("span",{class:$(e(i).e("inner"))},null,2)],2),g("span",{class:$(e(i).e("label")),onKeydown:r[4]||(r[4]=Q(()=>{},["stop"]))},[q(_.$slots,"default",{},()=>[M(D(_.label),1)])],34)],2)}}});var Ba=Y(Ca,[["__file","radio.vue"]]);const Ia=H({...$e}),La=["value","name","disabled"],Ta=G({name:"ElRadioButton"}),Ra=G({...Ta,props:Ia,setup(c){const k=c,t=X("radio"),{radioRef:i,focus:l,size:w,disabled:u,modelValue:y,radioGroup:f,actualValue:v}=Be(k),S=C(()=>({backgroundColor:(f==null?void 0:f.fill)||"",borderColor:(f==null?void 0:f.fill)||"",boxShadow:f!=null&&f.fill?`-1px 0 0 0 ${f.fill}`:"",color:(f==null?void 0:f.textColor)||""}));return(s,_)=>{var r;return h(),B("label",{class:$([e(t).b("button"),e(t).is("active",e(y)===e(v)),e(t).is("disabled",e(u)),e(t).is("focus",e(l)),e(t).bm("button",e(w))])},[ve(g("input",{ref_key:"radioRef",ref:i,"onUpdate:modelValue":_[0]||(_[0]=V=>ye(y)?y.value=V:null),class:$(e(t).be("button","original-radio")),value:e(v),type:"radio",name:s.name||((r=e(f))==null?void 0:r.name),disabled:e(u),onFocus:_[1]||(_[1]=V=>l.value=!0),onBlur:_[2]||(_[2]=V=>l.value=!1),onClick:_[3]||(_[3]=Q(()=>{},["stop"]))},null,42,La),[[be,e(y)]]),g("span",{class:$(e(t).be("button","inner")),style:ae(e(y)===e(v)?e(S):{}),onKeydown:_[4]||(_[4]=Q(()=>{},["stop"]))},[q(s.$slots,"default",{},()=>[M(D(s.label),1)])],38)],2)}}});var Ie=Y(Ra,[["__file","radio-button.vue"]]);const Na=H({id:{type:String,default:void 0},size:pe,disabled:Boolean,modelValue:{type:[String,Number,Boolean],default:void 0},fill:{type:String,default:""},label:{type:String,default:void 0},textColor:{type:String,default:""},name:{type:String,default:void 0},validateEvent:{type:Boolean,default:!0}}),Da=Ve,Ga=["id","aria-label","aria-labelledby"],Pa=G({name:"ElRadioGroup"}),xa=G({...Pa,props:Na,emits:Da,setup(c,{emit:k}){const t=c,i=X("radio"),l=He(),w=T(),{formItem:u}=Je(),{inputId:y,isLabeledByFormItem:f}=We(t,{formItemContext:u}),v=s=>{k(te,s),he(()=>k("change",s))};we(()=>{const s=w.value.querySelectorAll("[type=radio]"),_=s[0];!Array.from(s).some(r=>r.checked)&&_&&(_.tabIndex=0)});const S=C(()=>t.name||l.value);return Qe(Ce,W({...Xe(t),changeEvent:v,name:S})),Ye(()=>t.modelValue,()=>{t.validateEvent&&(u==null||u.validate("change").catch(s=>Ze()))}),(s,_)=>(h(),B("div",{id:e(y),ref_key:"radioGroupRef",ref:w,class:$(e(i).b("group")),role:"radiogroup","aria-label":e(f)?void 0:s.label||"radio-group","aria-labelledby":e(f)?e(u).labelId:void 0},[q(s.$slots,"default")],10,Ga))}});var Le=Y(xa,[["__file","radio-group.vue"]]);ke(Ba,{RadioButton:Ie,RadioGroup:Le});const za=Se(Le),Fa=Se(Ie),Ua=H({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:Oe}}),Aa={click:c=>c instanceof MouseEvent},Ma=["href","target"],Ka=G({name:"ElLink"}),qa=G({...Ka,props:Ua,emits:Aa,setup(c,{emit:k}){const t=c,i=X("link"),l=C(()=>[i.b(),i.m(t.type),i.is("disabled",t.disabled),i.is("underline",t.underline&&!t.disabled)]);function w(u){t.disabled||k("click",u)}return(u,y)=>(h(),B("a",{class:$(e(l)),href:u.disabled||!u.href?void 0:u.href,target:u.disabled||!u.href?void 0:u.target,onClick:w},[u.icon?(h(),z(e(Ee),{key:0},{default:p(()=>[(h(),z(je(u.icon)))]),_:1})):K("v-if",!0),u.$slots.default?(h(),B("span",{key:1,class:$(e(i).e("inner"))},[q(u.$slots,"default")],2)):K("v-if",!0),u.$slots.icon?q(u.$slots,"icon",{key:2}):K("v-if",!0)],10,Ma))}});var Ha=Y(qa,[["__file","link.vue"]]);const Ja=ke(Ha),Wa=c=>(ua("data-v-518c7f16"),c=c(),da(),c),Qa={class:"page-anime page-box"},Xa={class:"anime-box inner-box"},Ya=Wa(()=>g("div",{class:"nav-anime nav-box"},null,-1)),Za={class:"anime-wrap"},Oa=["onClick"],ja={class:"anime-name"},et={class:"detail-wrap"},at=["title"],tt={class:"detail-form-wrap"},lt={class:"ep-wrap"},st={class:"ep-box"},nt={class:"state-wrap"},ot={class:"label label-state"},it={class:"torrent-wrap"},rt=["onClick"],ut={class:"torrent-title"},dt=["onClick","title"],ct=["onClick","title"],ft={__name:"AnimePage",setup(c){const k=aa(),{settings:t,userData:i}=ta(k),l=ge("langs"),w=T(i.value.is_admin),u=W({anime:null}),y=T(!0),f=T(!0),v=T(!1),S=T(!1),s=W({aid:null,title:null,poster:null,save_path:null,season:[],seasonSelected:0,torrentList:[],epList:null}),_=T(!1),r=W({name:null,season:null,ep:null,epStateInfo:null,torrentList:[],activeTid:null}),V=async()=>{f.value=!0;let a=s.aid,o=await A("GET",`/api/anime/detail?aid=${a}`).catch(b=>console.log(b));o&&(o.code<0||(s.torrentList=o.data,await le()))},F=async()=>{if(!w.value){L({message:l[t.value.lang].msg_err_not_admin,type:"error"});return}let a=s.aid;await A("POST","/api/anime/refresh",{aid:a}).catch(b=>(L({message:l[t.value.lang].anime.msg_refresh_poster_error,type:"error"}),console.log(b)))&&(S.value=!1,L({message:l[t.value.lang].anime.msg_refresh_poster_success,type:"success"}),y.value=!0,await se())},Te=a=>a.ep&&!isNaN(parseFloat(a.ep))?`${l[t.value.lang].anime.ep_prefix}${a.ep}${l[t.value.lang].anime.ep_suffix}`:a.name?a.name:l.value[t.value.lang].anime.ep,R=a=>{let o=l[t.value.lang].anime;return a.state==0?[ca,"warning",!0,o.msg_ep_state_wait]:a.state==1?[fa,"warning",!0,o.msg_ep_state_queue]:a.state==2?[ma,"primary",!0,o.msg_ep_state_download]:a.state==3?[_a,"success",!1,o.msg_ep_state_finish]:a.state==-1?[pa,"info",!0,o.msg_ep_state_operate]:a.state==-2?[j,"info",!1,o.msg_ep_state_filtered]:a.state==-3?[ee,"danger",!1,o.msg_ep_state_torrent_err]:a.state==-4?[ee,"danger",!1,o.msg_ep_state_unknown]:a.state==-5?[j,"info",!1,o.msg_ep_state_same]:a.state==-6?[j,"info",!1,o.msg_ep_state_same_torrent]:[ee,"danger",!1,o.msg_ep_state_error]},le=async()=>{f.value=!0;let a=s.torrentList,o=s.season[s.seasonSelected],b=[];for(let d=0;d<a.length;d++){let E=JSON.parse(a[d].meta),x=a[d].file_name,J=a[d].tid;a[d].state<0&&(J=null);let N=[!0,null];for(let I=0;I<b.length;I++)if(b[I].name==x){N=[!1,I];break}if(N[0]){if(E.info.season&&E.info.season!==o)continue;b.push({tid:J,name:x,state:a[d].state,season:E.info.season||null,ep:E.info.ep||null,torrentList:[a[d]]});continue}if(!E.info.season||E.info.season==o){let I=b[N[1]].state;if(b[N[1]].torrentList.push(a[d]),a[d].state>=-1&&a[d].state>I||a[d].state<-2&&a[d].state>-5&&I<-1){if(b[N[1]].state=a[d].state,a[d].state<0)continue;b[N[1]].tid=a[d].tid;continue}}}b.sort((d,E)=>d.ep<E.ep?-1:d.ep>E.ep?1:0),s.epList=b,f.value=!1},Re=async()=>{f.value=!0,await le(),f.value=!1},Ne=async a=>{f.value=!0,s.aid=a.aid,s.title=a.title,s.poster=a.poster_path||a.poster_url,s.seasonSelected=0,s.save_path=a.save_path,s.season=JSON.parse(a.season).sort(),s.torrentList=[],s.epList=null,S.value=!0,f.value=!0,await V()},De=async a=>{if(!w.value){L({message:l[t.value.lang].msg_err_not_admin,type:"error"});return}r.epObj=a,r.name=a.name,r.season=a.season,r.ep=a.ep,r.torrentList=a.torrentList,r.epStateInfo=R(a),r.activeTid=a.tid,_.value=!0},Ge=a=>a==r.activeTid?l[t.value.lang].anime.msg_torrent_active:l[t.value.lang].anime.msg_click_to_toggle,Pe=async a=>{if(v.value)return;let o=r.activeTid;if(a==o){_e.confirm(`<b>${l[t.value.lang].anime.msg_cancel_confirm_blod}</b>`,l[t.value.lang].anime.msg_cancel_confirm,{confirmButtonText:l[t.value.lang].confirm,cancelButtonText:l[t.value.lang].cancel,type:"warning",icon:fe(me),dangerouslyUseHTMLString:!0,customClass:"el-dialog-icon"}).then(async()=>{v.value=!0,await A("POST","/api/torrent/cancel",{tid:o}).catch(d=>(L({message:d.msg||l[t.value.lang].msg_err_reload,type:"error"}),console.log(d)))&&(_.value=!1,await V(),v.value=!1,L({message:l[t.value.lang].anime.msg_toggle_success,type:"success"}))});return}_e.confirm(`<b>${l[t.value.lang].anime.msg_toggle_confirm_blod}</b>`,l[t.value.lang].anime.msg_toggle_confirm,{confirmButtonText:l[t.value.lang].confirm,cancelButtonText:l[t.value.lang].cancel,type:"warning",icon:fe(me),dangerouslyUseHTMLString:!0,customClass:"el-dialog-icon"}).then(async()=>{v.value=!0;let b=await A("POST","/api/torrent/toggle",{tid_from:o,tid_to:a}).catch(d=>(L({message:d.msg||l[t.value.lang].msg_err_reload,type:"error"}),console.log(d)));b&&(_.value=!1,console.log(o,a,b),await V(),v.value=!1,L({message:l[t.value.lang].anime.msg_toggle_success,type:"success"}))})},xe=a=>{navigator.clipboard.writeText(a),L({message:l[t.value.lang].msg_copy_success,type:"success"})},ze=a=>{window.open(a,"target","")},se=async()=>{let a=await A("GET","/api/anime/gallery").catch(o=>console.log(o));a&&(u.anime=a.data),y.value=!1};return we(async()=>{await se()}),(a,o)=>{const b=la,d=Ee,E=ga,x=va,J=ba,N=Fa,I=za,Fe=ya,ne=Ja,oe=wa,U=ka,Ue=Sa,ie=ha;return h(),B("main",Qa,[g("div",Xa,[Ya,m(b,{loading:y.value},null,8,["loading"]),g("div",Za,[(h(!0),B(Z,null,O(u.anime,n=>(h(),B("div",{class:"anime",key:n.aid,style:ae({backgroundImage:`url(${n.poster_path||n.poster_url})`}),onClick:P=>Ne(n)},[g("div",ja,D(n.title),1)],12,Oa))),128))])]),m(ie,{modelValue:S.value,"onUpdate:modelValue":o[5]||(o[5]=n=>S.value=n)},{default:p(()=>[g("div",et,[g("div",{class:"anime-poster",style:ae({backgroundImage:`url(${s.poster})`}),onClick:o[0]||(o[0]=n=>F())},[g("div",{class:"refresh-wrap",title:e(l)[e(t).lang].anime.refresh_poster},[m(d,{size:50},{default:p(()=>[m(e(sa))]),_:1})],8,at)],4),g("div",tt,[m(J,{class:"detail-from","label-position":"right","label-width":"auto",model:s},{default:p(()=>[m(x,{label:e(l)[e(t).lang].anime.name},{default:p(()=>[m(E,{modelValue:s.title,"onUpdate:modelValue":o[1]||(o[1]=n=>s.title=n)},null,8,["modelValue"])]),_:1},8,["label"]),m(x,{label:e(l)[e(t).lang].anime.save_path},{default:p(()=>[m(E,{modelValue:s.save_path,"onUpdate:modelValue":o[2]||(o[2]=n=>s.save_path=n),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])]),g("div",lt,[m(x,{label:e(l)[e(t).lang].rss.season},{default:p(()=>[m(I,{modelValue:s.seasonSelected,"onUpdate:modelValue":o[3]||(o[3]=n=>s.seasonSelected=n),onChange:Re},{default:p(()=>[(h(!0),B(Z,null,O(s.season,(n,P)=>(h(),z(N,{key:P,label:`${e(l)[e(t).lang].rss.season_prefix}${e(l)[e(t).lang].rss.season_list[n]}${e(l)[e(t).lang].rss.season_suffix}`,value:P},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),g("div",st,[m(b,{loading:f.value},null,8,["loading"]),(h(!0),B(Z,null,O(s.epList,n=>(h(),z(Fe,{size:"small",key:n,icon:R(n)[0],type:R(n)[1],plain:R(n)[2],title:R(n)[3],onClick:P=>De(n)},{default:p(()=>[M(D(Te(n)),1)]),_:2},1032,["icon","type","plain","title","onClick"]))),128))])]),m(ie,{modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=n=>_.value=n),title:r.name,"append-to-body":"",class:"ep-details-wrap"},{default:p(()=>[g("div",nt,[g("div",ot,D(e(l)[e(t).lang].anime.ep_state),1),m(ne,{class:"el-link-state",icon:r.epStateInfo[0],type:r.epStateInfo[1],underline:!1},{default:p(()=>[M(D(r.epStateInfo[3]),1)]),_:1},8,["icon","type"])]),g("div",it,[m(Ue,{class:"torrent-table",data:r.torrentList},{default:p(()=>[m(U,{label:e(l)[e(t).lang].anime.toggle,width:"60",align:"center","class-name":"column-btn"},{default:p(n=>[m(oe,{placement:"left",width:160,trigger:"hover",content:Ge(n.row.tid),"popper-class":"break-all"},{reference:p(()=>[g("div",{class:$(["btn-icon btn-toggle",{active:r.activeTid==n.row.tid,disabled:v.value}]),style:{display:"flex","align-items":"center"},onClick:P=>Pe(n.row.tid)},[r.activeTid!==n.row.tid?(h(),z(d,{key:0,size:20},{default:p(()=>[m(e(na))]),_:1})):K("",!0),r.activeTid==n.row.tid?(h(),z(d,{key:1,size:24},{default:p(()=>[m(e(oa))]),_:1})):K("",!0)],10,rt)]),_:2},1032,["content"])]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.torrent_title},{default:p(n=>[m(oe,{placement:"right",width:300,trigger:"hover",content:n.row.title,"popper-class":"break-all"},{reference:p(()=>[g("div",ut,D(n.row.title),1)]),_:2},1032,["content"])]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.torrent_url,width:"60",align:"center","class-name":"column-btn"},{default:p(n=>[g("div",{class:"btn-icon btn-url",style:{display:"flex","align-items":"center"},onClick:P=>xe(n.row.url),title:e(l)[e(t).lang].msg_click_to_copy},[m(d,{size:20},{default:p(()=>[m(e(ia))]),_:1})],8,dt)]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.homepage,width:"60",align:"center","class-name":"column-btn"},{default:p(n=>[g("div",{class:"btn-icon",style:{display:"flex","align-items":"center"},onClick:P=>ze(n.row.homepage),title:e(l)[e(t).lang].msg_click_to_open_in_blank},[m(d,{size:20},{default:p(()=>[m(e(ra))]),_:1})],8,ct)]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.state,width:"150",align:"center"},{default:p(n=>[m(ne,{class:"el-link-state",icon:R(n.row)[0],type:R(n.row)[1],underline:!1},{default:p(()=>[M(D(R(n.row)[3]),1)]),_:2},1032,["icon","type"])]),_:1},8,["label"])]),_:1},8,["data"])])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue"])])}}},gt=ea(ft,[["__scopeId","data-v-518c7f16"]]);export{gt as default};
