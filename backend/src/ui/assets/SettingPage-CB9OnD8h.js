import{b as ve,c2 as ke,c0 as _e,k as ne,bR as Te,l as ye,r as M,e as O,o as m,P as S,Q as d,w as de,n as C,s as x,p as t,S as H,R as Ce,T as q,m as P,x as pe,z as W,A as E,Z as we,Y as r,ar as xe,by as Pe,_ as Ve,b_ as Be,M as he,au as fe,C as Ne,c3 as le,a as U,ay as Y,U as J,u as Fe,av as Ue,I as ce,E as Ae,f as Me,g as Oe,K as $e,G as Ie,bz as Re,aJ as G,aG as De,c4 as qe,bW as ze,aM as Ee,t as ie,ai as Se,L as me,aB as te,bh as je,i as Le,V as Ke,W as Je,X as Ge,a1 as We,a0 as ue,c5 as ge,c6 as Ye,al as He,ak as Qe,$ as Xe,d as Ze,y as et,aj as tt}from"./index-fDup74pC.js";import{E as A,e as lt}from"./el-tag-loKsSbNi.js";import{a as nt,E as at}from"./el-switch-B05Nsmlm.js";const st=["light","dark"],ot=ve({title:{type:String,default:""},description:{type:String,default:""},type:{type:String,values:ke(_e),default:"info"},closable:{type:Boolean,default:!0},closeText:{type:String,default:""},showIcon:Boolean,center:Boolean,effect:{type:String,values:st,default:"light"}}),rt={close:p=>p instanceof MouseEvent},it=ne({name:"ElAlert"}),ut=ne({...it,props:ot,emits:rt,setup(p,{emit:B}){const a=p,{Close:l}=Be,n=Te(),s=ye("alert"),g=M(!0),u=O(()=>_e[a.type]),w=O(()=>[s.e("icon"),{[s.is("big")]:!!a.description||!!n.default}]),V=O(()=>({"with-description":a.description||n.default})),$=f=>{g.value=!1,B("close",f)};return(f,k)=>(m(),S(Pe,{name:t(s).b("fade"),persisted:""},{default:d(()=>[de(C("div",{class:x([t(s).b(),t(s).m(f.type),t(s).is("center",f.center),t(s).is(f.effect)]),role:"alert"},[f.showIcon&&t(u)?(m(),S(t(H),{key:0,class:x(t(w))},{default:d(()=>[(m(),S(Ce(t(u))))]),_:1},8,["class"])):q("v-if",!0),C("div",{class:x(t(s).e("content"))},[f.title||f.$slots.title?(m(),P("span",{key:0,class:x([t(s).e("title"),t(V)])},[pe(f.$slots,"title",{},()=>[W(E(f.title),1)])],2)):q("v-if",!0),f.$slots.default||f.description?(m(),P("p",{key:1,class:x(t(s).e("description"))},[pe(f.$slots,"default",{},()=>[W(E(f.description),1)])],2)):q("v-if",!0),f.closable?(m(),P(we,{key:2},[f.closeText?(m(),P("div",{key:0,class:x([t(s).e("close-btn"),t(s).is("customed")]),onClick:$},E(f.closeText),3)):(m(),S(t(H),{key:1,class:x(t(s).e("close-btn")),onClick:$},{default:d(()=>[r(t(l))]),_:1},8,["class"]))],64)):q("v-if",!0)],2)],2),[[xe,g.value]])]),_:3},8,["name"]))}});var dt=Ve(ut,[["__file","alert.vue"]]);const ct=he(dt),pt=100,ft=600,be={beforeMount(p,B){const a=B.value,{interval:l=pt,delay:n=ft}=fe(a)?{}:a;let s,g;const u=()=>fe(a)?a():a.handler(),w=()=>{g&&(clearTimeout(g),g=void 0),s&&(clearInterval(s),s=void 0)};p.addEventListener("mousedown",V=>{V.button===0&&(w(),u(),document.addEventListener("mouseup",()=>w(),{once:!0}),g=setTimeout(()=>{s=setInterval(()=>{u()},l)},n))})}},mt=ve({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:Fe,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:p=>p===null||U(p)||["min","max"].includes(p),default:null},name:String,label:String,placeholder:String,precision:{type:Number,validator:p=>p>=0&&p===Number.parseInt(`${p}`,10)},validateEvent:{type:Boolean,default:!0}}),gt={[Ne]:(p,B)=>B!==p,blur:p=>p instanceof FocusEvent,focus:p=>p instanceof FocusEvent,[le]:p=>U(p)||Y(p),[J]:p=>U(p)||Y(p)},bt=["aria-label","onKeydown"],vt=["aria-label","onKeydown"],_t=ne({name:"ElInputNumber"}),yt=ne({..._t,props:mt,emits:gt,setup(p,{expose:B,emit:a}){const l=p,{t:n}=Ue(),s=ye("input-number"),g=M(),u=ce({currentValue:l.modelValue,userInput:null}),{formItem:w}=Ae(),V=O(()=>U(l.modelValue)&&l.modelValue<=l.min),$=O(()=>U(l.modelValue)&&l.modelValue>=l.max),f=O(()=>{const e=Q(l.step);return te(l.precision)?Math.max(Q(l.modelValue),e):(e>l.precision,l.precision)}),k=O(()=>l.controls&&l.controlsPosition==="right"),z=Me(),R=Oe(),L=O(()=>{if(u.userInput!==null)return u.userInput;let e=u.currentValue;if(Y(e))return"";if(U(e)){if(Number.isNaN(e))return"";te(l.precision)||(e=e.toFixed(l.precision))}return e}),j=(e,o)=>{if(te(o)&&(o=f.value),o===0)return Math.round(e);let c=String(e);const b=c.indexOf(".");if(b===-1||!c.replace(".","").split("")[b+o])return e;const Z=c.length;return c.charAt(Z-1)==="5"&&(c=`${c.slice(0,Math.max(0,Z-1))}6`),Number.parseFloat(Number(c).toFixed(o))},Q=e=>{if(Y(e))return 0;const o=e.toString(),c=o.indexOf(".");let b=0;return c!==-1&&(b=o.length-c-1),b},K=(e,o=1)=>U(e)?j(e+l.step*o):u.currentValue,_=()=>{if(l.readonly||R.value||$.value)return;const e=Number(L.value)||0,o=K(e);T(o),a(le,u.currentValue),D()},i=()=>{if(l.readonly||R.value||V.value)return;const e=Number(L.value)||0,o=K(e,-1);T(o),a(le,u.currentValue),D()},h=(e,o)=>{const{max:c,min:b,step:v,precision:F,stepStrictly:Z,valueOnClear:ee}=l;c<b&&je("InputNumber","min should not be greater than max.");let I=Number(e);if(Y(e)||Number.isNaN(I))return null;if(e===""){if(ee===null)return null;I=Le(ee)?{min:b,max:c}[ee]:ee}return Z&&(I=j(Math.round(I/v)*v,F)),te(F)||(I=j(I,F)),(I>c||I<b)&&(I=I>c?c:b,o&&a(J,I)),I},T=(e,o=!0)=>{var c;const b=u.currentValue,v=h(e);if(!o){a(J,v);return}b===v&&e||(u.userInput=null,a(J,v),b!==v&&a(Ne,v,b),l.validateEvent&&((c=w==null?void 0:w.validate)==null||c.call(w,"change").catch(F=>me())),u.currentValue=v)},X=e=>{u.userInput=e;const o=e===""?null:Number(e);a(le,o),T(o,!1)},y=e=>{const o=e!==""?Number(e):"";(U(o)&&!Number.isNaN(o)||e==="")&&T(o),D(),u.userInput=null},N=()=>{var e,o;(o=(e=g.value)==null?void 0:e.focus)==null||o.call(e)},ae=()=>{var e,o;(o=(e=g.value)==null?void 0:e.blur)==null||o.call(e)},se=e=>{a("focus",e)},oe=e=>{var o;u.userInput=null,a("blur",e),l.validateEvent&&((o=w==null?void 0:w.validate)==null||o.call(w,"blur").catch(c=>me()))},D=()=>{u.currentValue!==l.modelValue&&(u.currentValue=l.modelValue)},re=e=>{document.activeElement===e.target&&e.preventDefault()};return $e(()=>l.modelValue,(e,o)=>{const c=h(e,!0);u.userInput===null&&c!==o&&(u.currentValue=c)},{immediate:!0}),Ie(()=>{var e;const{min:o,max:c,modelValue:b}=l,v=(e=g.value)==null?void 0:e.input;if(v.setAttribute("role","spinbutton"),Number.isFinite(c)?v.setAttribute("aria-valuemax",String(c)):v.removeAttribute("aria-valuemax"),Number.isFinite(o)?v.setAttribute("aria-valuemin",String(o)):v.removeAttribute("aria-valuemin"),v.setAttribute("aria-valuenow",u.currentValue||u.currentValue===0?String(u.currentValue):""),v.setAttribute("aria-disabled",String(R.value)),!U(b)&&b!=null){let F=Number(b);Number.isNaN(F)&&(F=null),a(J,F)}}),Re(()=>{var e,o;const c=(e=g.value)==null?void 0:e.input;c==null||c.setAttribute("aria-valuenow",`${(o=u.currentValue)!=null?o:""}`)}),B({focus:N,blur:ae}),(e,o)=>(m(),P("div",{class:x([t(s).b(),t(s).m(t(z)),t(s).is("disabled",t(R)),t(s).is("without-controls",!e.controls),t(s).is("controls-right",t(k))]),onDragstart:o[0]||(o[0]=ie(()=>{},["prevent"]))},[e.controls?de((m(),P("span",{key:0,role:"button","aria-label":t(n)("el.inputNumber.decrease"),class:x([t(s).e("decrease"),t(s).is("disabled",t(V))]),onKeydown:G(i,["enter"])},[r(t(H),null,{default:d(()=>[t(k)?(m(),S(t(De),{key:0})):(m(),S(t(qe),{key:1}))]),_:1})],42,bt)),[[t(be),i]]):q("v-if",!0),e.controls?de((m(),P("span",{key:1,role:"button","aria-label":t(n)("el.inputNumber.increase"),class:x([t(s).e("increase"),t(s).is("disabled",t($))]),onKeydown:G(_,["enter"])},[r(t(H),null,{default:d(()=>[t(k)?(m(),S(t(ze),{key:0})):(m(),S(t(Ee),{key:1}))]),_:1})],42,vt)),[[t(be),_]]):q("v-if",!0),r(t(Se),{id:e.id,ref_key:"input",ref:g,type:"number",step:e.step,"model-value":t(L),placeholder:e.placeholder,readonly:e.readonly,disabled:t(R),size:t(z),max:e.max,min:e.min,name:e.name,label:e.label,"validate-event":!1,onWheel:re,onKeydown:[G(ie(_,["prevent"]),["up"]),G(ie(i,["prevent"]),["down"])],onBlur:oe,onFocus:se,onInput:X,onChange:y},null,8,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","label","onKeydown"])],34))}});var wt=Ve(yt,[["__file","input-number.vue"]]);const Vt=he(wt),ht={class:"page-setting page-box"},Nt={class:"setting-box inner-box"},It={class:"config-wrap"},Et={class:"add-filter-wrap"},St={key:0,class:"btn-wrap"},kt={__name:"SettingPage",setup(p){const B=Je(),{settings:a}=Ge(B),l=Ze("langs"),n=ce({config:null,configInit:null}),s=ce({username:null,password:null,passwordRepeat:null}),g=M(!0),u=M(!1),w=M(!1),V=async()=>{if(n.config){if(!n.config.http&&!n.config.https&&(n.config.http=!0,A({message:l[a.value.lang].setting.msg_server_warning,type:"warning"})),n.config.jobs.scan_rss.split(" ").length!==6&&(n.config.jobs.scan_rss=n.configInit.jobs.scan_rss,A({message:l[a.value.lang].setting.msg_cron_error,type:"error"})),JSON.stringify(n.config)!==JSON.stringify(n.configInit)||s.username){w.value=!0;return}w.value=!1}},$=()=>{n.config=JSON.parse(JSON.stringify(n.configInit)),s.username=null,s.password=null,s.passwordRepeat=null,V()},f=M(),k=M(""),z=M(!1),R=_=>{n.config.filter.splice(n.config.filter.indexOf(_),1),V()},L=()=>{z.value=!0,et(()=>{f.value.input.focus()})},j=()=>{k.value&&n.config.filter.push(k.value),z.value=!1,k.value="",V()},Q=async()=>{if(s.password&&!s.username){A({message:l[a.value.lang].setting.msg_error_empty_username,type:"error"});return}if(s.username&&!s.password){A({message:l[a.value.lang].setting.msg_error_empty_password,type:"error"});return}if(s.password!==s.passwordRepeat){A({message:l[a.value.lang].setting.msg_password_repeat_error,type:"error"});return}u.value=!0;let _=!1;if(s.username){if(console.log(s),!await ue("POST","/api/user/update",{admin:!0,username:s.username,password:ge.sha256(`${s.username}${ge.sha256(s.password)}`)}).catch(T=>(A({message:T.msg||l[a.value.lang].msg_err_reload,type:"error"}),u.value=!1,console.log(T))))return;_=!0}if(await ue("POST","/api/config/update",{config:JSON.stringify(n.config)}).catch(h=>(A({message:h.msg||l[a.value.lang].msg_err_reload,type:"error"}),u.value=!1,console.log(h)))){if(A({message:l[a.value.lang].setting.msg_save_success,type:"success"}),g.value=!0,u.value=!1,_){Ye(),location.reload();return}K()}},K=async()=>{let _=await ue("GET","/api/config/get").catch(i=>{if(i.code==-50102){g.value=!1;return}return console.log(i)});_&&(n.config=_.data,n.configInit=JSON.parse(JSON.stringify(_.data)),V(),g.value=!1)};return Ie(async()=>{await K()}),(_,i)=>{const h=ct,T=lt,X=Vt,y=tt,N=Se,ae=nt,se=at,oe=H,D=He,re=Qe;return m(),P("main",ht,[C("div",Nt,[r(We,{loading:g.value},null,8,["loading"]),C("div",It,[r(re,{class:"config-form",model:n.config,trigger:"change","label-width":"auto",style:{"max-width":"600px"},"hide-required-asterisk":"",onChange:V},{default:d(()=>[r(h,{class:"config-alert",type:"info","show-icon":"",closable:!1},{default:d(()=>[C("p",null,E(t(l)[t(a).lang].setting.alert_server),1)]),_:1}),r(T,{label:"HTTP",modelValue:n.config.http,"onUpdate:modelValue":i[0]||(i[0]=e=>n.config.http=e),disabled:""},null,8,["modelValue"]),r(y,{label:t(l)[t(a).lang].setting.port},{default:d(()=>[r(X,{modelValue:n.config.port[0],"onUpdate:modelValue":i[1]||(i[1]=e=>n.config.port[0]=e),controls:!1,precision:0,min:1,max:65535,disabled:!n.config.http},null,8,["modelValue","disabled"])]),_:1},8,["label"]),r(T,{label:"HTTPS",modelValue:n.config.https,"onUpdate:modelValue":i[2]||(i[2]=e=>n.config.https=e),disabled:""},null,8,["modelValue"]),r(y,{label:t(l)[t(a).lang].setting.port},{default:d(()=>[r(X,{modelValue:n.config.port[1],"onUpdate:modelValue":i[3]||(i[3]=e=>n.config.port[1]=e),controls:!1,precision:0,min:1,max:65535,disabled:!n.config.https},null,8,["modelValue","disabled"])]),_:1},8,["label"]),r(y,{label:t(l)[t(a).lang].setting.ca_key},{default:d(()=>[r(N,{modelValue:n.config.ca.key,"onUpdate:modelValue":i[4]||(i[4]=e=>n.config.ca.key=e),style:{width:"400px"},disabled:!n.config.https},null,8,["modelValue","disabled"])]),_:1},8,["label"]),r(y,{label:t(l)[t(a).lang].setting.ca_cert},{default:d(()=>[r(N,{modelValue:n.config.ca.cert,"onUpdate:modelValue":i[5]||(i[5]=e=>n.config.ca.cert=e),style:{width:"400px"},disabled:!n.config.https},null,8,["modelValue","disabled"])]),_:1},8,["label"]),r(h,{class:"config-alert",type:"info","show-icon":"",closable:!1},{default:d(()=>[C("p",null,E(t(l)[t(a).lang].setting.alert_admin),1)]),_:1}),r(y,{label:t(l)[t(a).lang].setting.admin_username},{default:d(()=>[r(N,{modelValue:s.username,"onUpdate:modelValue":i[6]||(i[6]=e=>s.username=e),style:{width:"400px"}},null,8,["modelValue"])]),_:1},8,["label"]),r(y,{label:t(l)[t(a).lang].setting.admin_password,error:_.errorMsg},{default:d(()=>[r(N,{modelValue:s.password,"onUpdate:modelValue":i[7]||(i[7]=e=>s.password=e),type:"password",style:{width:"400px"},"show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["label","error"]),r(y,{label:t(l)[t(a).lang].setting.admin_password_repeat,error:_.errorMsg},{default:d(()=>[r(N,{modelValue:s.passwordRepeat,"onUpdate:modelValue":i[8]||(i[8]=e=>s.passwordRepeat=e),type:"password",style:{width:"400px"},"show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["label","error"]),r(h,{class:"config-alert",type:"info","show-icon":"",closable:!1},{default:d(()=>[C("p",null,E(t(l)[t(a).lang].setting.alert_qb),1)]),_:1}),r(y,{label:t(l)[t(a).lang].setting.qb_host},{default:d(()=>[r(N,{modelValue:n.config.qBittorrent.host,"onUpdate:modelValue":i[9]||(i[9]=e=>n.config.qBittorrent.host=e),style:{width:"400px"},autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label"]),r(y,{label:t(l)[t(a).lang].setting.qb_username},{default:d(()=>[r(N,{modelValue:n.config.qBittorrent.username,"onUpdate:modelValue":i[10]||(i[10]=e=>n.config.qBittorrent.username=e),style:{width:"400px"}},null,8,["modelValue"])]),_:1},8,["label"]),r(y,{label:t(l)[t(a).lang].setting.qb_password,error:_.errorMsg},{default:d(()=>[r(N,{modelValue:n.config.qBittorrent.password,"onUpdate:modelValue":i[11]||(i[11]=e=>n.config.qBittorrent.password=e),type:"password",style:{width:"400px"},"show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["label","error"]),r(h,{class:"config-alert",type:"info","show-icon":"",closable:!1},{default:d(()=>[C("p",null,E(t(l)[t(a).lang].setting.alert_download),1)]),_:1}),r(y,{label:t(l)[t(a).lang].anime.save_path},{default:d(()=>[r(N,{modelValue:n.config.save_path,"onUpdate:modelValue":i[12]||(i[12]=e=>n.config.save_path=e),style:{width:"400px"}},null,8,["modelValue"])]),_:1},8,["label"]),r(h,{class:"config-alert",type:"info","show-icon":"",closable:!1},{default:d(()=>[C("p",null,E(t(l)[t(a).lang].setting.alert_rss),1)]),_:1}),r(y,{label:t(l)[t(a).lang].setting.subscribe},{default:d(()=>[r(ae,{modelValue:n.config.subscribe,"onUpdate:modelValue":i[13]||(i[13]=e=>n.config.subscribe=e),"inline-prompt":"","active-text":t(l)[t(a).lang].setting.yes,"inactive-text":t(l)[t(a).lang].setting.no,onChange:V},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),r(y,{label:t(l)[t(a).lang].rss.filter},{default:d(()=>[C("div",Et,[(m(!0),P(we,null,Xe(n.config.filter,e=>(m(),S(se,{key:e,closable:"","disable-transitions":!1,onClose:o=>R(e)},{default:d(()=>[W(E(e),1)]),_:2},1032,["onClose"]))),128)),z.value?(m(),S(N,{key:0,ref_key:"FilterInputRef",ref:f,modelValue:k.value,"onUpdate:modelValue":i[14]||(i[14]=e=>k.value=e),class:"filter-input",size:"small",onKeyup:G(j,["enter"]),onBlur:j},null,8,["modelValue"])):(m(),S(D,{key:1,class:"button-new-tag",size:"small",onClick:L},{default:d(()=>[r(oe,null,{default:d(()=>[r(t(Ee))]),_:1})]),_:1}))])]),_:1},8,["label"]),r(h,{class:"config-alert",type:"info","show-icon":"",closable:!1,title:t(l)[t(a).lang].setting.alert_jobs,description:t(l)[t(a).lang].setting.alert_jobs_sub},null,8,["title","description"]),r(y,{label:t(l)[t(a).lang].setting.jobs.scan_rss},{default:d(()=>[r(N,{modelValue:n.config.jobs.scan_rss,"onUpdate:modelValue":i[15]||(i[15]=e=>n.config.jobs.scan_rss=e),style:{width:"400px"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),w.value?(m(),P("div",St,[r(D,{type:"info",plain:"",onClick:$},{default:d(()=>[W(E(t(l)[t(a).lang].reset),1)]),_:1}),r(D,{type:"primary",onClick:Q,loading:u.value},{default:d(()=>[W(E(t(l)[t(a).lang].save),1)]),_:1},8,["loading"])])):q("",!0)])])}}},Pt=Ke(kt,[["__scopeId","data-v-fe4c5384"]]);export{Pt as default};
