import{b as q,U as te,i as re,a as ue,c as de,C as xe,u as fe,r as L,d as me,e as V,f as Fe,g as Ue,h as Ae,j as ce,k as D,l as X,o as h,m as C,n as g,w as _e,v as pe,p as e,q as ge,s as $,t as Q,x as K,_ as Y,y as ve,z as A,A as N,B as ae,D as Me,E as Ke,F as qe,G as be,H as He,I as W,J as Je,K as We,L as Qe,M as ye,N as he,O as Xe,P as x,Q as p,R as Ye,S as we,T as M,V as Ze,W as Oe,X as je,Y as f,Z,$ as O,a0 as J,a1 as ea,a2 as aa,a3 as ta,a4 as la,a5 as sa,a6 as na,a7 as oa,a8 as ia,a9 as ra,aa as ua,ab as da,ac as ca,ad as fa,ae as j,af as ee,ag as ma,ah as _a,ai as pa,aj as ga,ak as va,al as ba}from"./index-2B4XHYhB.js";import{E as ya,a as ha,b as wa,c as ka,d as Sa}from"./el-popover-2wLeJ_Hi.js";import{E as z}from"./el-tag-z2-Yr_7O.js";const ke=q({modelValue:{type:[String,Number,Boolean],default:void 0},size:fe,disabled:Boolean,label:{type:[String,Number,Boolean],default:void 0},value:{type:[String,Number,Boolean],default:void 0},name:{type:String,default:void 0}}),Ea=q({...ke,border:Boolean}),Se={[te]:d=>re(d)||ue(d)||de(d),[xe]:d=>re(d)||ue(d)||de(d)},Ee=Symbol("radioGroupKey"),$e=(d,k)=>{const t=L(),i=me(Ee,void 0),l=V(()=>!!i),w=V(()=>ce(d.value)?d.label:d.value),u=V({get(){return l.value?i.modelValue:d.modelValue},set(s){l.value?i.changeEvent(s):k&&k(te,s),t.value.checked=d.modelValue===w.value}}),y=Fe(V(()=>i==null?void 0:i.size)),c=Ue(V(()=>i==null?void 0:i.disabled)),v=L(!1),S=V(()=>c.value||l.value&&u.value!==w.value?-1:0);return Ae({from:"label act as value",replacement:"value",version:"3.0.0",scope:"el-radio",ref:"https://element-plus.org/en-US/component/radio.html"},V(()=>l.value&&ce(d.value))),{radioRef:t,isGroup:l,radioGroup:i,focus:v,size:y,disabled:c,tabIndex:S,modelValue:u,actualValue:w}},$a=["value","name","disabled"],Va=D({name:"ElRadio"}),Ca=D({...Va,props:Ea,emits:Se,setup(d,{emit:k}){const t=d,i=X("radio"),{radioRef:l,radioGroup:w,focus:u,size:y,disabled:c,modelValue:v,actualValue:S}=$e(t,k);function s(){ve(()=>k("change",v.value))}return(_,r)=>{var I;return h(),C("label",{class:$([e(i).b(),e(i).is("disabled",e(c)),e(i).is("focus",e(u)),e(i).is("bordered",_.border),e(i).is("checked",e(v)===e(S)),e(i).m(e(y))])},[g("span",{class:$([e(i).e("input"),e(i).is("disabled",e(c)),e(i).is("checked",e(v)===e(S))])},[_e(g("input",{ref_key:"radioRef",ref:l,"onUpdate:modelValue":r[0]||(r[0]=F=>ge(v)?v.value=F:null),class:$(e(i).e("original")),value:e(S),name:_.name||((I=e(w))==null?void 0:I.name),disabled:e(c),type:"radio",onFocus:r[1]||(r[1]=F=>u.value=!0),onBlur:r[2]||(r[2]=F=>u.value=!1),onChange:s,onClick:r[3]||(r[3]=Q(()=>{},["stop"]))},null,42,$a),[[pe,e(v)]]),g("span",{class:$(e(i).e("inner"))},null,2)],2),g("span",{class:$(e(i).e("label")),onKeydown:r[4]||(r[4]=Q(()=>{},["stop"]))},[K(_.$slots,"default",{},()=>[A(N(_.label),1)])],34)],2)}}});var Ia=Y(Ca,[["__file","radio.vue"]]);const Ba=q({...ke}),La=["value","name","disabled"],Ta=D({name:"ElRadioButton"}),Ra=D({...Ta,props:Ba,setup(d){const k=d,t=X("radio"),{radioRef:i,focus:l,size:w,disabled:u,modelValue:y,radioGroup:c,actualValue:v}=$e(k),S=V(()=>({backgroundColor:(c==null?void 0:c.fill)||"",borderColor:(c==null?void 0:c.fill)||"",boxShadow:c!=null&&c.fill?`-1px 0 0 0 ${c.fill}`:"",color:(c==null?void 0:c.textColor)||""}));return(s,_)=>{var r;return h(),C("label",{class:$([e(t).b("button"),e(t).is("active",e(y)===e(v)),e(t).is("disabled",e(u)),e(t).is("focus",e(l)),e(t).bm("button",e(w))])},[_e(g("input",{ref_key:"radioRef",ref:i,"onUpdate:modelValue":_[0]||(_[0]=I=>ge(y)?y.value=I:null),class:$(e(t).be("button","original-radio")),value:e(v),type:"radio",name:s.name||((r=e(c))==null?void 0:r.name),disabled:e(u),onFocus:_[1]||(_[1]=I=>l.value=!0),onBlur:_[2]||(_[2]=I=>l.value=!1),onClick:_[3]||(_[3]=Q(()=>{},["stop"]))},null,42,La),[[pe,e(y)]]),g("span",{class:$(e(t).be("button","inner")),style:ae(e(y)===e(v)?e(S):{}),onKeydown:_[4]||(_[4]=Q(()=>{},["stop"]))},[K(s.$slots,"default",{},()=>[A(N(s.label),1)])],38)],2)}}});var Ve=Y(Ra,[["__file","radio-button.vue"]]);const Na=q({id:{type:String,default:void 0},size:fe,disabled:Boolean,modelValue:{type:[String,Number,Boolean],default:void 0},fill:{type:String,default:""},label:{type:String,default:void 0},textColor:{type:String,default:""},name:{type:String,default:void 0},validateEvent:{type:Boolean,default:!0}}),Da=Se,Ga=["id","aria-label","aria-labelledby"],za=D({name:"ElRadioGroup"}),Pa=D({...za,props:Na,emits:Da,setup(d,{emit:k}){const t=d,i=X("radio"),l=Me(),w=L(),{formItem:u}=Ke(),{inputId:y,isLabeledByFormItem:c}=qe(t,{formItemContext:u}),v=s=>{k(te,s),ve(()=>k("change",s))};be(()=>{const s=w.value.querySelectorAll("[type=radio]"),_=s[0];!Array.from(s).some(r=>r.checked)&&_&&(_.tabIndex=0)});const S=V(()=>t.name||l.value);return He(Ee,W({...Je(t),changeEvent:v,name:S})),We(()=>t.modelValue,()=>{t.validateEvent&&(u==null||u.validate("change").catch(s=>Qe()))}),(s,_)=>(h(),C("div",{id:e(y),ref_key:"radioGroupRef",ref:w,class:$(e(i).b("group")),role:"radiogroup","aria-label":e(c)?void 0:s.label||"radio-group","aria-labelledby":e(c)?e(u).labelId:void 0},[K(s.$slots,"default")],10,Ga))}});var Ce=Y(Pa,[["__file","radio-group.vue"]]);ye(Ia,{RadioButton:Ve,RadioGroup:Ce});const xa=he(Ce),Fa=he(Ve),Ua=q({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:Xe}}),Aa={click:d=>d instanceof MouseEvent},Ma=["href","target"],Ka=D({name:"ElLink"}),qa=D({...Ka,props:Ua,emits:Aa,setup(d,{emit:k}){const t=d,i=X("link"),l=V(()=>[i.b(),i.m(t.type),i.is("disabled",t.disabled),i.is("underline",t.underline&&!t.disabled)]);function w(u){t.disabled||k("click",u)}return(u,y)=>(h(),C("a",{class:$(e(l)),href:u.disabled||!u.href?void 0:u.href,target:u.disabled||!u.href?void 0:u.target,onClick:w},[u.icon?(h(),x(e(we),{key:0},{default:p(()=>[(h(),x(Ye(u.icon)))]),_:1})):M("v-if",!0),u.$slots.default?(h(),C("span",{key:1,class:$(e(i).e("inner"))},[K(u.$slots,"default")],2)):M("v-if",!0),u.$slots.icon?K(u.$slots,"icon",{key:2}):M("v-if",!0)],10,Ma))}});var Ha=Y(qa,[["__file","link.vue"]]);const Ja=ye(Ha),Wa=d=>(oa("data-v-377d510c"),d=d(),ia(),d),Qa={class:"page-anime page-box"},Xa={class:"anime-box inner-box"},Ya=Wa(()=>g("div",{class:"nav-anime nav-box"},null,-1)),Za={class:"anime-wrap"},Oa=["onClick"],ja={class:"anime-name"},et={class:"detail-wrap"},at=["title"],tt={class:"detail-form-wrap"},lt={class:"ep-wrap"},st={class:"ep-box"},nt={class:"state-wrap"},ot={class:"label label-state"},it={class:"torrent-wrap"},rt=["onClick"],ut={class:"torrent-title"},dt=["onClick","title"],ct=["onClick","title"],ft={__name:"AnimePage",setup(d){const k=Oe(),{settings:t,userData:i}=je(k),l=me("langs"),w=L(i.value.is_admin),u=W({anime:null}),y=L(!0),c=L(!0),v=L(!1),S=L(!1),s=W({aid:null,title:null,poster:null,save_path:null,season:[],seasonSelected:0,torrentList:[],epList:null}),_=L(!1),r=W({name:null,season:null,ep:null,epStateInfo:null,torrentList:[],activeTid:null}),I=async()=>{c.value=!0;let a=s.aid,o=await J("GET",`/api/anime/detail?aid=${a}`).catch(b=>console.log(b));o&&(o.code<0||(s.torrentList=o.data,await le()))},F=async()=>{if(!w.value){z({message:l[t.value.lang].msg_err_not_admin,type:"error"});return}let a=s.aid;await J("POST","/api/anime/refresh",{aid:a}).catch(b=>(z({message:l[t.value.lang].anime.msg_refresh_poster_error,type:"error"}),console.log(b)))&&(S.value=!1,z({message:l[t.value.lang].anime.msg_refresh_poster_success,type:"success"}),y.value=!0,await se())},Ie=a=>a.ep&&!isNaN(parseFloat(a.ep))?`${l[t.value.lang].anime.ep_prefix}${a.ep}${l[t.value.lang].anime.ep_suffix}`:a.name?a.name:l.value[t.value.lang].anime.ep,T=a=>{let o=l[t.value.lang].anime;return a.state==0?[ra,"warning",!0,o.msg_ep_state_wait]:a.state==1?[ua,"warning",!0,o.msg_ep_state_queue]:a.state==2?[da,"primary",!0,o.msg_ep_state_download]:a.state==3?[ca,"success",!1,o.msg_ep_state_finish]:a.state==-1?[fa,"info",!0,o.msg_ep_state_operate]:a.state==-2?[j,"info",!1,o.msg_ep_state_filtered]:a.state==-3?[ee,"danger",!1,o.msg_ep_state_torrent_err]:a.state==-4?[ee,"danger",!1,o.msg_ep_state_unknown]:a.state==-5?[j,"info",!1,o.msg_ep_state_same]:a.state==-6?[j,"info",!1,o.msg_ep_state_same_torrent]:[ee,"danger",!1,o.msg_ep_state_error]},le=async()=>{c.value=!0;let a=s.torrentList,o=s.season[s.seasonSelected],b=[];for(let m=0;m<a.length;m++){let E=JSON.parse(a[m].meta),P=a[m].file_name,H=a[m].tid;a[m].state<0&&(H=null);let R=[!0,null];for(let B=0;B<b.length;B++)if(b[B].name==P){R=[!1,B];break}if(R[0]){if(E.info.season&&E.info.season!==o)continue;b.push({tid:H,name:P,state:a[m].state,season:E.info.season||null,ep:E.info.ep||null,torrentList:[a[m]]});continue}if(!E.info.season||E.info.season==o){let B=b[R[1]].state;if(b[R[1]].torrentList.push(a[m]),a[m].state>=-1&&a[m].state>B||a[m].state<-2&&a[m].state>-5&&B<-1){if(b[R[1]].state=a[m].state,a[m].state<0)continue;b[R[1]].tid=a[m].tid;continue}}}b.sort((m,E)=>m.ep<E.ep?-1:m.ep>E.ep?1:0),s.epList=b,c.value=!1},Be=async()=>{c.value=!0,await le(),c.value=!1},Le=async a=>{c.value=!0,s.aid=a.aid,s.title=a.title,s.poster=a.poster_path||a.poster_url,s.seasonSelected=0,s.save_path=a.save_path,s.season=JSON.parse(a.season).sort(),s.torrentList=[],s.epList=null,S.value=!0,c.value=!0,await I()},Te=async a=>{if(!w.value){z({message:l[t.value.lang].msg_err_not_admin,type:"error"});return}r.epObj=a,r.name=a.name,r.season=a.season,r.ep=a.ep,r.torrentList=a.torrentList,r.epStateInfo=T(a),r.activeTid=a.tid,_.value=!0},Re=a=>a==r.activeTid?l[t.value.lang].anime.msg_torrent_active:l[t.value.lang].anime.msg_click_to_toggle,Ne=async a=>{if(v.value)return;let o=r.activeTid;a!=o&&ha.confirm(`<b>${l[t.value.lang].anime.msg_toggle_confirm_blod}</b>`,l[t.value.lang].anime.msg_toggle_confirm,{confirmButtonText:l[t.value.lang].confirm,cancelButtonText:l[t.value.lang].cancel,type:"warning",icon:ma(_a),dangerouslyUseHTMLString:!0,customClass:"el-dialog-icon"}).then(async()=>{v.value=!0;let b=await J("POST","/api/torrent/toggle",{tid_from:o,tid_to:a}).catch(m=>(z({message:m.msg||l[t.value.lang].msg_err_reload,type:"error"}),console.log(m)));b&&(_.value=!1,console.log(o,a,b),await I(),v.value=!1,z({message:l[t.value.lang].anime.msg_toggle_success,type:"success"}))})},De=a=>{navigator.clipboard.writeText(a),z({message:l[t.value.lang].msg_copy_success,type:"success"})},Ge=a=>{window.open(a,"target","")},se=async()=>{let a=await J("GET","/api/anime/gallery").catch(o=>console.log(o));a&&(u.anime=a.data),y.value=!1};return be(async()=>{await se()}),(a,o)=>{const b=ea,m=we,E=pa,P=ga,H=va,R=Fa,B=xa,ze=ba,ne=Ja,oe=wa,U=ka,Pe=Sa,ie=ya;return h(),C("main",Qa,[g("div",Xa,[Ya,f(b,{loading:y.value},null,8,["loading"]),g("div",Za,[(h(!0),C(Z,null,O(u.anime,n=>(h(),C("div",{class:"anime",key:n.aid,style:ae({backgroundImage:`url(${n.poster_path||n.poster_url})`}),onClick:G=>Le(n)},[g("div",ja,N(n.title),1)],12,Oa))),128))])]),f(ie,{modelValue:S.value,"onUpdate:modelValue":o[5]||(o[5]=n=>S.value=n)},{default:p(()=>[g("div",et,[g("div",{class:"anime-poster",style:ae({backgroundImage:`url(${s.poster})`}),onClick:o[0]||(o[0]=n=>F())},[g("div",{class:"refresh-wrap",title:e(l)[e(t).lang].anime.refresh_poster},[f(m,{size:50},{default:p(()=>[f(e(aa))]),_:1})],8,at)],4),g("div",tt,[f(H,{class:"detail-from","label-position":"right","label-width":"auto",model:s},{default:p(()=>[f(P,{label:e(l)[e(t).lang].anime.name},{default:p(()=>[f(E,{modelValue:s.title,"onUpdate:modelValue":o[1]||(o[1]=n=>s.title=n)},null,8,["modelValue"])]),_:1},8,["label"]),f(P,{label:e(l)[e(t).lang].anime.save_path},{default:p(()=>[f(E,{modelValue:s.save_path,"onUpdate:modelValue":o[2]||(o[2]=n=>s.save_path=n),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])]),g("div",lt,[f(P,{label:e(l)[e(t).lang].rss.season},{default:p(()=>[f(B,{modelValue:s.seasonSelected,"onUpdate:modelValue":o[3]||(o[3]=n=>s.seasonSelected=n),onChange:Be},{default:p(()=>[(h(!0),C(Z,null,O(s.season,(n,G)=>(h(),x(R,{key:G,label:`${e(l)[e(t).lang].rss.season_prefix}${e(l)[e(t).lang].rss.season_list[n]}${e(l)[e(t).lang].rss.season_suffix}`,value:G},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),g("div",st,[f(b,{loading:c.value},null,8,["loading"]),(h(!0),C(Z,null,O(s.epList,n=>(h(),x(ze,{size:"small",key:n,icon:T(n)[0],type:T(n)[1],plain:T(n)[2],title:T(n)[3],onClick:G=>Te(n)},{default:p(()=>[A(N(Ie(n)),1)]),_:2},1032,["icon","type","plain","title","onClick"]))),128))])]),f(ie,{modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=n=>_.value=n),title:r.name,"append-to-body":"",class:"ep-details-wrap"},{default:p(()=>[g("div",nt,[g("div",ot,N(e(l)[e(t).lang].anime.ep_state),1),f(ne,{class:"el-link-state",icon:r.epStateInfo[0],type:r.epStateInfo[1],underline:!1},{default:p(()=>[A(N(r.epStateInfo[3]),1)]),_:1},8,["icon","type"])]),g("div",it,[f(Pe,{class:"torrent-table",data:r.torrentList},{default:p(()=>[f(U,{label:e(l)[e(t).lang].anime.toggle,width:"60",align:"center","class-name":"column-btn"},{default:p(n=>[f(oe,{placement:"left",width:160,trigger:"hover",content:Re(n.row.tid),"popper-class":"break-all"},{reference:p(()=>[g("div",{class:$(["btn-icon btn-toggle",{active:r.activeTid==n.row.tid,disabled:v.value}]),style:{display:"flex","align-items":"center"},onClick:G=>Ne(n.row.tid)},[r.activeTid!==n.row.tid?(h(),x(m,{key:0,size:20},{default:p(()=>[f(e(ta))]),_:1})):M("",!0),r.activeTid==n.row.tid?(h(),x(m,{key:1,size:24},{default:p(()=>[f(e(la))]),_:1})):M("",!0)],10,rt)]),_:2},1032,["content"])]),_:1},8,["label"]),f(U,{label:e(l)[e(t).lang].anime.torrent_title},{default:p(n=>[f(oe,{placement:"right",width:300,trigger:"hover",content:n.row.title,"popper-class":"break-all"},{reference:p(()=>[g("div",ut,N(n.row.title),1)]),_:2},1032,["content"])]),_:1},8,["label"]),f(U,{label:e(l)[e(t).lang].anime.torrent_url,width:"60",align:"center","class-name":"column-btn"},{default:p(n=>[g("div",{class:"btn-icon btn-url",style:{display:"flex","align-items":"center"},onClick:G=>De(n.row.url),title:e(l)[e(t).lang].msg_click_to_copy},[f(m,{size:20},{default:p(()=>[f(e(sa))]),_:1})],8,dt)]),_:1},8,["label"]),f(U,{label:e(l)[e(t).lang].anime.homepage,width:"60",align:"center","class-name":"column-btn"},{default:p(n=>[g("div",{class:"btn-icon",style:{display:"flex","align-items":"center"},onClick:G=>Ge(n.row.homepage),title:e(l)[e(t).lang].msg_click_to_open_in_blank},[f(m,{size:20},{default:p(()=>[f(e(na))]),_:1})],8,ct)]),_:1},8,["label"]),f(U,{label:e(l)[e(t).lang].anime.state,width:"150",align:"center"},{default:p(n=>[f(ne,{class:"el-link-state",icon:T(n.row)[0],type:T(n.row)[1],underline:!1},{default:p(()=>[A(N(T(n.row)[3]),1)]),_:2},1032,["icon","type"])]),_:1},8,["label"])]),_:1},8,["data"])])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue"])])}}},gt=Ze(ft,[["__scopeId","data-v-377d510c"]]);export{gt as default};
