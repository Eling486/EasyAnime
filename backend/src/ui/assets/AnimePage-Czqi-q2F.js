import{b as H,U as te,i as re,a as ue,c as de,C as Me,u as pe,r as N,d as ge,e as B,f as Ke,g as qe,h as He,j as ce,k as D,l as X,o as y,m as I,n as g,w as ve,v as be,p as e,q as ye,s as E,t as Q,x as q,_ as Y,y as he,z as K,A as x,B as ae,D as Je,E as We,F as Qe,G as we,H as Xe,I as W,J as Ye,K as Ze,L as Oe,M as ke,N as Se,O as je,P,Q as p,R as ea,S as Ee,T as A,V as aa,W as ta,X as la,Y as m,Z,$ as O,a0 as M,a1 as sa,a2 as na,a3 as oa,a4 as ia,a5 as ra,a6 as ua,a7 as da,a8 as ca,a9 as fa,aa as ma,ab as _a,ac as pa,ad as ga,ae as j,af as ee,ag as fe,ah as me,ai as va,aj as ba,ak as ya,al as ha}from"./index-CDx34Lf9.js";import{E as wa,a as _e,b as ka,c as Sa,d as Ea}from"./el-popover-UwK7HthA.js";import{E as T}from"./el-tag-CzeVt6nH.js";const $e=H({modelValue:{type:[String,Number,Boolean],default:void 0},size:pe,disabled:Boolean,label:{type:[String,Number,Boolean],default:void 0},value:{type:[String,Number,Boolean],default:void 0},name:{type:String,default:void 0}}),$a=H({...$e,border:Boolean}),Ve={[te]:f=>re(f)||ue(f)||de(f),[Me]:f=>re(f)||ue(f)||de(f)},Ce=Symbol("radioGroupKey"),Be=(f,k)=>{const t=N(),i=ge(Ce,void 0),l=B(()=>!!i),w=B(()=>ce(f.value)?f.label:f.value),u=B({get(){return l.value?i.modelValue:f.modelValue},set(s){l.value?i.changeEvent(s):k&&k(te,s),t.value.checked=f.modelValue===w.value}}),h=Ke(B(()=>i==null?void 0:i.size)),c=qe(B(()=>i==null?void 0:i.disabled)),v=N(!1),S=B(()=>c.value||l.value&&u.value!==w.value?-1:0);return He({from:"label act as value",replacement:"value",version:"3.0.0",scope:"el-radio",ref:"https://element-plus.org/en-US/component/radio.html"},B(()=>l.value&&ce(f.value))),{radioRef:t,isGroup:l,radioGroup:i,focus:v,size:h,disabled:c,tabIndex:S,modelValue:u,actualValue:w}},Va=["value","name","disabled"],Ca=D({name:"ElRadio"}),Ba=D({...Ca,props:$a,emits:Ve,setup(f,{emit:k}){const t=f,i=X("radio"),{radioRef:l,radioGroup:w,focus:u,size:h,disabled:c,modelValue:v,actualValue:S}=Be(t,k);function s(){he(()=>k("change",v.value))}return(_,r)=>{var V;return y(),I("label",{class:E([e(i).b(),e(i).is("disabled",e(c)),e(i).is("focus",e(u)),e(i).is("bordered",_.border),e(i).is("checked",e(v)===e(S)),e(i).m(e(h))])},[g("span",{class:E([e(i).e("input"),e(i).is("disabled",e(c)),e(i).is("checked",e(v)===e(S))])},[ve(g("input",{ref_key:"radioRef",ref:l,"onUpdate:modelValue":r[0]||(r[0]=F=>ye(v)?v.value=F:null),class:E(e(i).e("original")),value:e(S),name:_.name||((V=e(w))==null?void 0:V.name),disabled:e(c),type:"radio",onFocus:r[1]||(r[1]=F=>u.value=!0),onBlur:r[2]||(r[2]=F=>u.value=!1),onChange:s,onClick:r[3]||(r[3]=Q(()=>{},["stop"]))},null,42,Va),[[be,e(v)]]),g("span",{class:E(e(i).e("inner"))},null,2)],2),g("span",{class:E(e(i).e("label")),onKeydown:r[4]||(r[4]=Q(()=>{},["stop"]))},[q(_.$slots,"default",{},()=>[K(x(_.label),1)])],34)],2)}}});var Ia=Y(Ba,[["__file","radio.vue"]]);const La=H({...$e}),Ta=["value","name","disabled"],Na=D({name:"ElRadioButton"}),Ra=D({...Na,props:La,setup(f){const k=f,t=X("radio"),{radioRef:i,focus:l,size:w,disabled:u,modelValue:h,radioGroup:c,actualValue:v}=Be(k),S=B(()=>({backgroundColor:(c==null?void 0:c.fill)||"",borderColor:(c==null?void 0:c.fill)||"",boxShadow:c!=null&&c.fill?`-1px 0 0 0 ${c.fill}`:"",color:(c==null?void 0:c.textColor)||""}));return(s,_)=>{var r;return y(),I("label",{class:E([e(t).b("button"),e(t).is("active",e(h)===e(v)),e(t).is("disabled",e(u)),e(t).is("focus",e(l)),e(t).bm("button",e(w))])},[ve(g("input",{ref_key:"radioRef",ref:i,"onUpdate:modelValue":_[0]||(_[0]=V=>ye(h)?h.value=V:null),class:E(e(t).be("button","original-radio")),value:e(v),type:"radio",name:s.name||((r=e(c))==null?void 0:r.name),disabled:e(u),onFocus:_[1]||(_[1]=V=>l.value=!0),onBlur:_[2]||(_[2]=V=>l.value=!1),onClick:_[3]||(_[3]=Q(()=>{},["stop"]))},null,42,Ta),[[be,e(h)]]),g("span",{class:E(e(t).be("button","inner")),style:ae(e(h)===e(v)?e(S):{}),onKeydown:_[4]||(_[4]=Q(()=>{},["stop"]))},[q(s.$slots,"default",{},()=>[K(x(s.label),1)])],38)],2)}}});var Ie=Y(Ra,[["__file","radio-button.vue"]]);const xa=H({id:{type:String,default:void 0},size:pe,disabled:Boolean,modelValue:{type:[String,Number,Boolean],default:void 0},fill:{type:String,default:""},label:{type:String,default:void 0},textColor:{type:String,default:""},name:{type:String,default:void 0},validateEvent:{type:Boolean,default:!0}}),Da=Ve,Ga=["id","aria-label","aria-labelledby"],Pa=D({name:"ElRadioGroup"}),za=D({...Pa,props:xa,emits:Da,setup(f,{emit:k}){const t=f,i=X("radio"),l=Je(),w=N(),{formItem:u}=We(),{inputId:h,isLabeledByFormItem:c}=Qe(t,{formItemContext:u}),v=s=>{k(te,s),he(()=>k("change",s))};we(()=>{const s=w.value.querySelectorAll("[type=radio]"),_=s[0];!Array.from(s).some(r=>r.checked)&&_&&(_.tabIndex=0)});const S=B(()=>t.name||l.value);return Xe(Ce,W({...Ye(t),changeEvent:v,name:S})),Ze(()=>t.modelValue,()=>{t.validateEvent&&(u==null||u.validate("change").catch(s=>Oe()))}),(s,_)=>(y(),I("div",{id:e(h),ref_key:"radioGroupRef",ref:w,class:E(e(i).b("group")),role:"radiogroup","aria-label":e(c)?void 0:s.label||"radio-group","aria-labelledby":e(c)?e(u).labelId:void 0},[q(s.$slots,"default")],10,Ga))}});var Le=Y(za,[["__file","radio-group.vue"]]);ke(Ia,{RadioButton:Ie,RadioGroup:Le});const Aa=Se(Le),Fa=Se(Ie),Ua=H({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:je}}),Ma={click:f=>f instanceof MouseEvent},Ka=["href","target"],qa=D({name:"ElLink"}),Ha=D({...qa,props:Ua,emits:Ma,setup(f,{emit:k}){const t=f,i=X("link"),l=B(()=>[i.b(),i.m(t.type),i.is("disabled",t.disabled),i.is("underline",t.underline&&!t.disabled)]);function w(u){t.disabled||k("click",u)}return(u,h)=>(y(),I("a",{class:E(e(l)),href:u.disabled||!u.href?void 0:u.href,target:u.disabled||!u.href?void 0:u.target,onClick:w},[u.icon?(y(),P(e(Ee),{key:0},{default:p(()=>[(y(),P(ea(u.icon)))]),_:1})):A("v-if",!0),u.$slots.default?(y(),I("span",{key:1,class:E(e(i).e("inner"))},[q(u.$slots,"default")],2)):A("v-if",!0),u.$slots.icon?q(u.$slots,"icon",{key:2}):A("v-if",!0)],10,Ka))}});var Ja=Y(Ha,[["__file","link.vue"]]);const Wa=ke(Ja),Qa=f=>(da("data-v-a86cb4cf"),f=f(),ca(),f),Xa={class:"page-anime page-box"},Ya={class:"anime-box inner-box"},Za=Qa(()=>g("div",{class:"nav-anime nav-box"},null,-1)),Oa={class:"anime-wrap"},ja=["onClick"],et={class:"anime-name"},at={class:"detail-wrap"},tt=["title"],lt={class:"detail-form-wrap"},st={class:"ep-wrap"},nt={class:"ep-box"},ot={class:"state-wrap"},it={class:"label label-state"},rt={class:"torrent-wrap"},ut=["onClick"],dt={class:"torrent-title"},ct=["onClick","title"],ft=["onClick","title"],mt={__name:"AnimePage",setup(f){const k=ta(),{settings:t,userData:i}=la(k),l=ge("langs"),w=N(i.value.is_admin),u=W({anime:null}),h=N(!0),c=N(!0),v=N(!1),S=N(!1),s=W({aid:null,title:null,poster:null,save_path:null,season:[],seasonSelected:0,torrentList:[],epList:null}),_=N(!1),r=W({name:null,season:null,ep:null,epStateInfo:null,torrentList:[],activeTid:null}),V=async()=>{c.value=!0;let a=s.aid,n=await M("GET",`/api/anime/detail?aid=${a}`).catch(b=>console.log(b));n&&(n.code<0||(s.torrentList=n.data,Ne(),await le()))},F=async()=>{if(!w.value){T({message:l[t.value.lang].msg_err_not_admin,type:"error"});return}let a=s.aid;await M("POST","/api/anime/refresh",{aid:a}).catch(b=>(T({message:l[t.value.lang].anime.msg_refresh_poster_error,type:"error"}),console.log(b)))&&(S.value=!1,T({message:l[t.value.lang].anime.msg_refresh_poster_success,type:"success"}),h.value=!0,await se())},Te=a=>a.ep&&!isNaN(parseFloat(a.ep))?`${l[t.value.lang].anime.ep_prefix}${a.ep}${l[t.value.lang].anime.ep_suffix}`:a.name?a.name:l.value[t.value.lang].anime.ep,R=a=>{let n=l[t.value.lang].anime;return a.state==0?[fa,"warning",!0,n.msg_ep_state_wait]:a.state==1?[ma,"warning",!0,n.msg_ep_state_queue]:a.state==2?[_a,"primary",!0,n.msg_ep_state_download]:a.state==3?[pa,"success",!1,n.msg_ep_state_finish]:a.state==-1?[ga,"info",!0,n.msg_ep_state_operate]:a.state==-2?[j,"info",!1,n.msg_ep_state_filtered]:a.state==-3?[ee,"danger",!1,n.msg_ep_state_torrent_err]:a.state==-4?[ee,"danger",!1,n.msg_ep_state_unknown]:a.state==-5?[j,"info",!1,n.msg_ep_state_same]:a.state==-6?[j,"info",!1,n.msg_ep_state_same_torrent]:[ee,"danger",!1,n.msg_ep_state_error]},Ne=async()=>{c.value=!0;let a=s.torrentList;for(let n=0;n<a.length;n++){let b=JSON.parse(a[n].meta);if(!b.info.season||s.season.indexOf(b.info.season)<0){s.NAEp=!0;break}}},le=async()=>{c.value=!0;let a=s.torrentList,n=[],b=null;s.seasonSelected>=0&&(b=s.season[s.seasonSelected]);for(let d=0;d<a.length;d++){let C=JSON.parse(a[d].meta),z=a[d].file_name,J=a[d].tid;a[d].state<0&&(J=null);let $=[!0,null];for(let L=0;L<n.length;L++)if(n[L].name==z){$=[!1,L];break}if(C.info.season==b||!b&&s.season.indexOf(C.info.season)<0){if($[0]){n.push({tid:J,name:z,state:a[d].state,season:C.info.season||null,ep:C.info.ep||null,torrentList:[a[d]]});continue}if(!$[0]){console.log($);let L=n[$[1]].state;if(n[$[1]].torrentList.push(a[d]),a[d].state>=-1&&a[d].state>L||a[d].state<-2&&a[d].state>-5&&L<-1){if(n[$[1]].state=a[d].state,a[d].state<0)continue;n[$[1]].tid=a[d].tid;continue}}}}n.sort((d,C)=>d.ep<C.ep?-1:d.ep>C.ep?1:0),s.epList=n,c.value=!1},Re=async()=>{c.value=!0,await le(),c.value=!1},xe=async a=>{c.value=!0,s.aid=a.aid,s.title=a.title,s.poster=a.poster_path||a.poster_url,s.seasonSelected=0,s.save_path=a.save_path,s.season=JSON.parse(a.season).sort(),s.torrentList=[],s.epList=null,s.NAEp=!1,S.value=!0,c.value=!0,await V()},De=async a=>{if(!w.value){T({message:l[t.value.lang].msg_err_not_admin,type:"error"});return}r.epObj=a,r.name=a.name,r.season=a.season,r.ep=a.ep,r.torrentList=a.torrentList,r.epStateInfo=R(a),r.activeTid=a.tid,_.value=!0},Ge=a=>a==r.activeTid?l[t.value.lang].anime.msg_torrent_active:l[t.value.lang].anime.msg_click_to_toggle,Pe=async a=>{if(v.value)return;let n=r.activeTid;if(a==n){_e.confirm(`<b>${l[t.value.lang].anime.msg_cancel_confirm_blod}</b>`,l[t.value.lang].anime.msg_cancel_confirm,{confirmButtonText:l[t.value.lang].confirm,cancelButtonText:l[t.value.lang].cancel,type:"warning",icon:fe(me),dangerouslyUseHTMLString:!0,customClass:"el-dialog-icon"}).then(async()=>{v.value=!0,await M("POST","/api/torrent/cancel",{tid:n}).catch(d=>(T({message:d.msg||l[t.value.lang].msg_err_reload,type:"error"}),console.log(d)))&&(_.value=!1,await V(),v.value=!1,T({message:l[t.value.lang].anime.msg_toggle_success,type:"success"}))});return}_e.confirm(`<b>${l[t.value.lang].anime.msg_toggle_confirm_blod}</b>`,l[t.value.lang].anime.msg_toggle_confirm,{confirmButtonText:l[t.value.lang].confirm,cancelButtonText:l[t.value.lang].cancel,type:"warning",icon:fe(me),dangerouslyUseHTMLString:!0,customClass:"el-dialog-icon"}).then(async()=>{v.value=!0;let b=await M("POST","/api/torrent/toggle",{tid_from:n,tid_to:a}).catch(d=>(T({message:d.msg||l[t.value.lang].msg_err_reload,type:"error"}),console.log(d)));b&&(_.value=!1,console.log(n,a,b),await V(),v.value=!1,T({message:l[t.value.lang].anime.msg_toggle_success,type:"success"}))})},ze=a=>{navigator.clipboard.writeText(a),T({message:l[t.value.lang].msg_copy_success,type:"success"})},Ae=a=>{window.open(a,"target","")},se=async()=>{let a=await M("GET","/api/anime/gallery").catch(n=>console.log(n));a&&(u.anime=a.data),h.value=!1};return we(async()=>{await se()}),(a,n)=>{const b=sa,d=Ee,C=va,z=ba,J=ya,$=Fa,L=Aa,Fe=ha,ne=Wa,oe=ka,U=Sa,Ue=Ea,ie=wa;return y(),I("main",Xa,[g("div",Ya,[Za,m(b,{loading:h.value},null,8,["loading"]),g("div",Oa,[(y(!0),I(Z,null,O(u.anime,o=>(y(),I("div",{class:"anime",key:o.aid,style:ae({backgroundImage:`url(${o.poster_path||o.poster_url})`}),onClick:G=>xe(o)},[g("div",et,x(o.title),1)],12,ja))),128))])]),m(ie,{modelValue:S.value,"onUpdate:modelValue":n[5]||(n[5]=o=>S.value=o)},{default:p(()=>[g("div",at,[g("div",{class:"anime-poster",style:ae({backgroundImage:`url(${s.poster})`}),onClick:n[0]||(n[0]=o=>F())},[g("div",{class:"refresh-wrap",title:e(l)[e(t).lang].anime.refresh_poster},[m(d,{size:50},{default:p(()=>[m(e(na))]),_:1})],8,tt)],4),g("div",lt,[m(J,{class:"detail-from","label-position":"right","label-width":"auto",model:s},{default:p(()=>[m(z,{label:e(l)[e(t).lang].anime.name},{default:p(()=>[m(C,{modelValue:s.title,"onUpdate:modelValue":n[1]||(n[1]=o=>s.title=o)},null,8,["modelValue"])]),_:1},8,["label"]),m(z,{label:e(l)[e(t).lang].anime.save_path},{default:p(()=>[m(C,{modelValue:s.save_path,"onUpdate:modelValue":n[2]||(n[2]=o=>s.save_path=o),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])]),g("div",st,[m(z,{label:e(l)[e(t).lang].rss.season},{default:p(()=>[m(L,{modelValue:s.seasonSelected,"onUpdate:modelValue":n[3]||(n[3]=o=>s.seasonSelected=o),onChange:Re},{default:p(()=>[(y(!0),I(Z,null,O(s.season,(o,G)=>(y(),P($,{key:G,label:`${e(l)[e(t).lang].rss.season_prefix}${e(l)[e(t).lang].rss.season_list[o]}${e(l)[e(t).lang].rss.season_suffix}`,value:G},null,8,["label","value"]))),128)),s.NAEp?(y(),P($,{key:0,label:e(l)[e(t).lang].rss.season_NA,value:-1},null,8,["label"])):A("",!0)]),_:1},8,["modelValue"])]),_:1},8,["label"]),g("div",nt,[m(b,{loading:c.value},null,8,["loading"]),(y(!0),I(Z,null,O(s.epList,o=>(y(),P(Fe,{size:"small",key:o,icon:R(o)[0],type:R(o)[1],plain:R(o)[2],title:R(o)[3],onClick:G=>De(o)},{default:p(()=>[K(x(Te(o)),1)]),_:2},1032,["icon","type","plain","title","onClick"]))),128))])]),m(ie,{modelValue:_.value,"onUpdate:modelValue":n[4]||(n[4]=o=>_.value=o),title:r.name,"append-to-body":"",class:"ep-details-wrap"},{default:p(()=>[g("div",ot,[g("div",it,x(e(l)[e(t).lang].anime.ep_state),1),m(ne,{class:"el-link-state",icon:r.epStateInfo[0],type:r.epStateInfo[1],underline:!1},{default:p(()=>[K(x(r.epStateInfo[3]),1)]),_:1},8,["icon","type"])]),g("div",rt,[m(Ue,{class:"torrent-table",data:r.torrentList},{default:p(()=>[m(U,{label:e(l)[e(t).lang].anime.toggle,width:"60",align:"center","class-name":"column-btn"},{default:p(o=>[m(oe,{placement:"left",width:160,trigger:"hover",content:Ge(o.row.tid),"popper-class":"break-all"},{reference:p(()=>[g("div",{class:E(["btn-icon btn-toggle",{active:r.activeTid==o.row.tid,disabled:v.value}]),style:{display:"flex","align-items":"center"},onClick:G=>Pe(o.row.tid)},[r.activeTid!==o.row.tid?(y(),P(d,{key:0,size:20},{default:p(()=>[m(e(oa))]),_:1})):A("",!0),r.activeTid==o.row.tid?(y(),P(d,{key:1,size:24},{default:p(()=>[m(e(ia))]),_:1})):A("",!0)],10,ut)]),_:2},1032,["content"])]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.torrent_title},{default:p(o=>[m(oe,{placement:"right",width:300,trigger:"hover",content:o.row.title,"popper-class":"break-all"},{reference:p(()=>[g("div",dt,x(o.row.title),1)]),_:2},1032,["content"])]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.torrent_url,width:"60",align:"center","class-name":"column-btn"},{default:p(o=>[g("div",{class:"btn-icon btn-url",style:{display:"flex","align-items":"center"},onClick:G=>ze(o.row.url),title:e(l)[e(t).lang].msg_click_to_copy},[m(d,{size:20},{default:p(()=>[m(e(ra))]),_:1})],8,ct)]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.homepage,width:"60",align:"center","class-name":"column-btn"},{default:p(o=>[g("div",{class:"btn-icon",style:{display:"flex","align-items":"center"},onClick:G=>Ae(o.row.homepage),title:e(l)[e(t).lang].msg_click_to_open_in_blank},[m(d,{size:20},{default:p(()=>[m(e(ua))]),_:1})],8,ft)]),_:1},8,["label"]),m(U,{label:e(l)[e(t).lang].anime.state,width:"150",align:"center"},{default:p(o=>[m(ne,{class:"el-link-state",icon:R(o.row)[0],type:R(o.row)[1],underline:!1},{default:p(()=>[K(x(R(o.row)[3]),1)]),_:2},1032,["icon","type"])]),_:1},8,["label"])]),_:1},8,["data"])])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue"])])}}},vt=aa(mt,[["__scopeId","data-v-a86cb4cf"]]);export{vt as default};
